<!--
IDEA dependent build script! This script's succesful execution depends on
properties being set by IDEA before it is run. Do this by adding the
project classpath in the Build Properties dialog.
In addition, the copyclasspath task is found in a jar that Sam wrote. The
jar and the ant distribution jar must also be included in the classpath.
The name of the jar is currently antscripttest<xxx>.jar.

To createPrimaryBorder a jar than can be executed directly, the build.properties file
should define the variable ${main.class}

Properties expected to be set exteernal to this script (typically, in
build.properties):
main.class
distname
projectname
version
ignorepath      (those elements of the ant classpath that should not be
                included in the dependecy list for this project)


-->

<project name="General Ant Build Script" default="Generate Jar" basedir=".">

    <!-- Project specific properties   -->
    <property file="build.properties"/>

    <!--  Set ant output directories. They get made if they don't exist -->
    <property name="project_home" value=".."/>
    <property name="ant.output" value="${project_home}/ant_output"/>
    <property name="classes" location="${ant.output}/classes"/>
    <property name="jars" location="${ant.output}/jars"/>
    <property name="javadoc" location="${ant.output}/javadoc"/>
    <property name="lib" location="${ant.output}/lib"/>

    <!-- Set current sister directories, for backup and release data. -->
    <property name="development" location="${project_home}"/>
    <property name="backup" location="${project_home}/backup"/>
    <property name="releases" location="${project_home}/releases"/>

    <!-- Set up child directories, for during the build.  -->
    <property name="src" location="${development}/src"/>
    <property name="data" location="${development}/data"/>
    <property name="jfreechart-lib" location="${project_home}/jfreechart-phet-module/jfreechart-module/lib"/>

    <property name="addl-classpath" value="${project_home}/piccolo-phet-module/phetcommon-module/lib/jnlp.jar;${jfreechart-lib}/gnujaxp.jar;${jfreechart-lib}/jcommon-1.0.0.jar;${jfreechart-lib}/jfreechart-1.0.0.jar"/>

    <description>
        Build File.
    </description>

    <target name="init">
        <tstamp/>
    </target>

    <!--    Backup source-->
    <target name="Backup Source" depends="init">
        <mkdir dir="${backup}"/>
        <tstamp>
            <format property="backup.time" pattern="d-MMMM-yyyy h-maa" locale="en"></format>
        </tstamp>
        <mkdir dir="${backup}/src_${backup.time}"/>
        <copy todir="${backup}/src_${backup.time}">
            <fileset dir="${src}"/>
        </copy>
    </target>

    <!--    Backup everything in the development directory. -->
    <target name="Backup Development" depends="init">
        <mkdir dir="${backup}"/>
        <tstamp>
            <format property="backup.time" pattern="d-MMMM-yyyy h-maa" locale="en"></format>
        </tstamp>
        <mkdir dir="${backup}/dev_${backup.time}"/>
        <copy todir="${backup}/dev_${backup.time}">
            <fileset dir="${development}"/>
        </copy>
    </target>

    <target name="Clean"
            description="clean up">
        <delete dir="${classes}"/>
        <delete dir="${jars}"/>
        <delete dir="${javadoc}"/>
        <delete dir="${lib}"/>
    </target>

    <target name="Compile" depends="init"
            description="compile the source ">
        <delete dir="${classes}"/>
        <mkdir dir="${classes}"/>
        <javac srcdir="${src}" destdir="${classes}">
            <src path="${project_home}/collision-dir/src"/>
            <src path="${project_home}/mechanics-dir/src"/>
            <src path="${project_home}/piccolo-phet-module/src"/>
            <src path="${project_home}/piccolo-phet-module/piccolo-module/src"/>
            <src path="${project_home}/piccolo-phet-module/piccolo-module/extras"/>
            <src path="${project_home}/piccolo-phet-module/phetcommon-module/src"/>
            <exclude name="edu/umd/cs/piccolox/swt/**"/>
            <classpath path="${addl-classpath}"/>
        </javac>
    </target>

    <target name="Generate Jar" depends="Compile"
            description="generate the distribution">
        <!-- Create the distribution directory -->
        <delete dir="${jars}"/>
        <mkdir dir="${jars}"/>
        <buildnumber/>
        <echo message="${jars}/${distname}.jar"/>
        <jar destfile="${jars}/${distname}.jar">
            <fileset dir="${classes}"/>
            <fileset dir="${data}"/>
            <fileset dir="${project_home}/piccolo-phet-module/phetcommon-module/data"/>
            <fileset dir="${project_home}/piccolo-phet-module/data"/>
            <!--<fileset dir="${addl-classpath}"/>-->
            <manifest>
                <attribute name="Built-By" value="${user.name}"/>
                <attribute name="version" value="${version}"/>
                <attribute name="build" value="${build.number}"/>
                <attribute name="Main-Class" value="${main.class}"/>
                <attribute name="cvs-tag" value="${cvs-tag}"/>
            </manifest>
        </jar>
    </target>

    <target name="Javadoc">
        <delete dir="${javadoc}"/>
        <javadoc destdir="${javadoc}" author="true" version="true" use="true">
            <packageset dir="${src}" defaultexcludes="yes">
            </packageset>
            <bottom><![CDATA[<i>Copyright &#169; 2003 PhET, R&S Software. All Rights Reserved.</i>]]></bottom>
            <link href="http://java.sun.com/products/jdk/1.4/docs/api/"/>
        </javadoc>
    </target>

</project>