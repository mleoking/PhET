Linear Circuit Analysis in the Circuit Construction Kit
PhET
Sam Reid

Circuit Analysis is essential for understanding and designing circuitry for a wide variety of important tasks.  Furthermore, Circuit Analysis lies at the intersection of several scientific fields, combining physics, graph theory and linear algebra.  The Physics Education Technology project (PhET), has developed a Linear Circuit Analysis simulation in order to educate high school and college students in Circuit theory.  The user can connect batteries, resistors, wires, light bulbs, switches, inductors and capacitors to create circuits, and there are voltmeters and ammeters for inspecting the system.  This document describes the programmatic details of how the current and voltage drops are computed in the circuit.
	The circuit is a graph; the junctions between components in the circuit are vertices, and the components are edges between the vertices.  The first step in the Circuit Analysis algorithm is to break up the graph into connected components; that is, if there are 2 circuits, each is solved independently.
In order to compute the unknown currents and voltages in a circuit, a technique called Modified Nodal Analysis (MNA) is used [1].  A matrix system Ax=b is constructed in which the unknown vector x is the set of unknown voltages (one for each vertex) and the unknown currents (one for each edge).  The matrix A and vector b are both constructed from the structure of the graph, and the values of the components in the circuit.  The structure of the matrix system is set by Kirkhoff’s laws, the physical model for the circuit.
	After construction of the matrix system, the unknown vector is determined through a linear algebra technique such as Gaussian Elimination.  The CCK is built on NIST’s public domain linear algebra software JAMA [2], which solves the matrix equation through QR Decomposition.
The current and potential values that have been determined are set to each component in the circuit.  The current values are used to graphically depict electron flow throughout the circuit, and the user can inspect the voltage drops by attaching probes of the voltmeter.
When a circuit contains reactive components such as inductors or capacitors, the Circuit Analysis is recomputed at each step in the simulation.  At each step, the reactive component is converted into a companion model consisting of voltage sources and resistors, and an integration approximation technique is used to determine the current through and total voltage drop across the companion model.
The series of steps described above are combined into the Circuit Analysis algorithm used in PhET’s CCK simulation.  It is our hope that this synthesis of physics, linear algebra and graph theory will be a productive educational tool.

[1] Electronic Circuit and System Simulation Methods, Lawrence T. Pillage, Ronald A. Rohrer, Chandramouli Visweswariah.  McGraw-Hill, 1995.
[2] JAMA http://math.nist.gov/javanumerics/jama/
