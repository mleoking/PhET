<project name="idealgas" default="package" >

    <target name="setProps" >
        <property name="project-name" value="idealgas" />
        <property name="main-class" value="edu.colorado.phet.idealgas.controller.IdealGasApplication" />
    </target>

    <target name="init" depends="setProps">
        <tstamp/>
        <property name="base-dir" value=".." />
        <property name="src-dir" value="${base-dir}/src" />
        <property name="test-dir" value="${base-dir}/test" />
        <property name="class-dir" value="${base-dir}/classes" />
        <property name="image-dir" value="${base-dir}/images" />
        <property name="lib-dir" value="${base-dir}/lib" />
        <property name="common-dir" value="../../common" />
        <property name="common-image-dir" value="${common-dir}/imagedir" />
        <property name="common-src-dir" value="${common-dir}/src" />

        <property name="jar-file-name" value="${project-name}.jar"/>
    </target>


    <!--
        Compiles the project
      -->
    <target name="compile" depends="init">
        <javac srcdir="${src-dir}:${test-dir}"
            destdir="${class-dir}"
            fork="true"
            optimize="off"
            compiler="jikes"
        />

    </target>

    <!--
        Creates a jar file for the project. Includes classes and gifs
      -->
    <target name="package" depends="init, compile">
    <echo message="${lib-dir}/${jar-file-name}" />
        <delete file="${jar-file-name}"/>
        <jar jarfile="${lib-dir}/${jar-file-name}">
            <manifest>
              <attribute name="Main-Class" value="${main-class}"/>
            </manifest>

            <fileset dir="${class-dir}"
                    includes="**/*.class"/>
            <fileset dir="${base-dir}/imagedir"
                    includes="**/*.gif"/>
        </jar>
    </target>


    <!--
        Archives all the source and images needed to build this
        release
    -->
    <target name="archive" depends="init">
        <property name="archive-name" value="${project-name}-archive.jar"/>

        <echo message="${lib-dir}/${archive-name}" />
        <delete file="${archive-name}"/>
        <jar jarfile="${lib-dir}/${archive-name}">
            <manifest>
              <attribute name="Main-Class" value="${main-class}"/>
            </manifest>

            <fileset dir="${class-dir}"
                    includes="**/*.class"/>
            <fileset dir="${base-dir}/imagedir"
                    includes="**/*.gif"/>
            <fileset dir="${common-image-dir}"
                    includes="**/*.gif"/>
            <fileset dir="${src-dir}"
                    includes="**/*.java" />
            <fileset dir="${test-dir}"
                    includes="**/*.java" />
            <fileset dir="${common-src-dir}"
                    includes="**/*.java" />
        </jar>
    </target>


    <!--
        Runs the application
      -->
    <target name="run" depends="package">
        <java jar="${lib-dir}/${jar-file-name}" fork="true" />
    </target >

    <!--
        FTPs the jar and jnlp files up to the PHET host
      -->
    <target name="upload" depends="package">
        <ftp server="spot.colorado.edu"
                userid="rjl"
                password="honda1002"
                remotedir="/htdocs/physics/PHET/${project-name}">
            <fileset dir="${base-dir}/build"
                    includes="*.jnlp"/>
            <fileset dir="${base-dir}/lib"
                    includes="*.jar"/>
        </ftp>
    </target>

</project>

