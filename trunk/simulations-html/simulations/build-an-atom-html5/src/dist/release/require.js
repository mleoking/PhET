var requirejs,require,define;(function(e){function l(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."&&t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function c(t,r){return function(){return n.apply(e,f.call(arguments,0).concat([t,r]))}}function h(e){return function(t){return l(t,e)}}function p(e){return function(t){s[e]=t}}function d(n){if(o.hasOwnProperty(n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!s.hasOwnProperty(n)&&!a.hasOwnProperty(n))throw new Error("No "+n);return s[n]}function v(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function m(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=[].slice;r=function(e,t){var n,r=v(e),i=r[0];return e=r[1],i&&(i=l(i,t),n=d(i)),i?n&&n.normalize?e=n.normalize(e,h(t)):e=l(e,t):(e=l(e,t),r=v(e),i=r[0],e=r[1],i&&(n=d(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return c(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:m(e)}}},t=function(t,n,u,f){var l,h,v,m,g,y=[],b;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(g=0;g<n.length;g+=1){m=r(n[g],f),h=m.f;if(h==="require")y[g]=i.require(t);else if(h==="exports")y[g]=i.exports(t),b=!0;else if(h==="module")l=y[g]=i.module(t);else if(s.hasOwnProperty(h)||o.hasOwnProperty(h)||a.hasOwnProperty(h))y[g]=d(h);else{if(!m.p)throw new Error(t+" missing "+h);m.p.load(m.n,c(f,!0),p(h),{}),y[g]=s[h]}}v=u.apply(s[t],y);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(v!==e||!b)s[t]=v}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):d(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},15),n)},n.config=function(e){return u=e,n},define=function(e,t,n){t.splice||(n=t,t=[]),o[e]=[e,t,n]},define.amd={jQuery:!0}})(),define("electron_shell",[],function(){function e(e){this.location=e,this.radius=120}return e.prototype.draw=function(e){var t=this.location.x,n=this.location.y,r=e.createRadialGradient(t,n,0,t,n,this.radius);r.addColorStop(0,"rgba( 0, 0, 200, 0.2)"),r.addColorStop(1,"rgba( 0, 0, 200, 0.05)"),e.fillStyle=r,e.beginPath(),e.arc(t,n,this.radius,0,Math.PI*2,!0),e.closePath(),e.fill()},e.prototype.setLocationComponents=function(e,t){this.location.x=e,this.location.y=t},e.prototype.setLocation=function(e){this.setLocationComponents(e.x,e.y)},e.prototype.containsPoint=function(e){return Math.sqrt(Math.pow(e.x-this.location.x,2)+Math.pow(e.y-this.location.y,2))<this.radius},e}),define("point2d",[],function(){function e(e,t){this.x=e,this.y=t}return e.prototype.toString=function(){return this.x+", "+this.y},e.prototype.setComponents=function(e,t){this.x=e,this.y=t},e.prototype.set=function(e){this.setComponents(e.x,e.y)},e.prototype.equals=function(e){return e.x==this.x&&e.y==this.y},e}),define("nucleon",["point2d"],function(e){function t(t){this.location=new e(0,0),this.radius=n,this.color=t}var n=20;return t.prototype.draw=function(e){var t=this.location.x,n=this.location.y,r=e.createRadialGradient(t-this.radius/3,n-this.radius/3,0,t,n,this.radius);r.addColorStop(0,"white"),r.addColorStop(1,this.color),e.fillStyle=r,e.beginPath(),e.arc(t,n,this.radius,0,Math.PI*2,!0),e.closePath(),e.fill()},t.prototype.setLocation=function(e){this.setLocationComponents(e.x,e.y)},t.prototype.setLocationComponents=function(e,t){this.location.x=e,this.location.y=t},t.prototype.containsPoint=function(e){return Math.sqrt(Math.pow(e.x-this.location.x,2)+Math.pow(e.y-this.location.y,2))<this.radius},t}),define("bucket",["point2d","nucleon"],function(e,t){function n(e,t,n){this.location=e,this.color=t,this.labelText=n,this.width=r*9,this.height=this.width*.35,this.nucleonsInBucket=[]}var r=20,i=10;return n.prototype.drawFront=function(e){var t=this.location.x,n=this.location.y,r=e.createLinearGradient(t,n,t+this.width,n);r.addColorStop(0,"white"),r.addColorStop(1,this.color),e.beginPath(),e.moveTo(t,n),e.lineTo(t+this.width*.15,n+this.height),e.bezierCurveTo(t+this.width*.4,n+this.height*1.1,t+this.width*.6,n+this.height*1.1,t+this.width*.85,n+this.height),e.lineTo(t+this.width,n),e.bezierCurveTo(t+this.width*.9,n+this.height*.2,t+this.width*.1,n+this.height*.2,t,n),e.closePath(),e.fillStyle=r,e.fill(),e.fillStyle="#000",e.font="22px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(this.labelText,this.location.x+this.width/2,this.location.y+this.height/2)},n.prototype.drawInterior=function(e){var t=this.location.x,n=this.location.y,r=e.createLinearGradient(t,n,t+this.width,n);r.addColorStop(0,this.color),r.addColorStop(1,"gray"),e.beginPath(),e.moveTo(t,n),e.bezierCurveTo(t+this.width*.1,n-this.height*.2,t+this.width*.9,n-this.height*.2,t+this.width,n),e.bezierCurveTo(t+this.width*.9,n+this.height*.2,t+this.width*.1,n+this.height*.2,t,n),e.fillStyle=r,e.fill()},n.prototype.addNucleonToBucket=function(e){e.setLocation(this.getNextOpenNucleonLocation()),this.nucleonsInBucket.push(e)},n.prototype.removeNucleonFromBucket=function(e){var t=this.nucleonsInBucket.indexOf(e);t!=-1&&this.nucleonsInBucket.splice(t,1)},n.prototype.removeAllParticles=function(){this.nucleonsInBucket.length=0},n.prototype.getNucleonLocationByIndex=function(n){var r,i=(new t("black")).radius,s=Math.round((this.width-2*i)/(i*2));return n<s-1?r=new e(this.location.x+i*2.5+n*i*2,this.location.y+i*.5):n<2*s-1?r=new e(this.location.x+i*1.5+(n-s+1)*i*2,this.location.y):n<3*s-2?r=new e(this.location.x+i*2.5+(n-s*2+1)*i*2,this.location.y-i*.5):(console.log("bucket capacity exceeded, using center"),r=new e(this.location.x+this.width/2,this.location.y)),r},n.prototype.getNextOpenNucleonLocation=function(){var e;for(var t=0;t<i;t++){e=this.getNucleonLocationByIndex(t);var n=!1;for(var r=0;r<this.nucleonsInBucket.length;r++)if(this.nucleonsInBucket[r].location.equals(e)){n=!0;break}if(!n)break}return e},n.prototype.setLocationComponents=function(e,t){this.location.x=e,this.location.y=t},n.prototype.setLocation=function(e){this.setLocationComponents(e.x,e.y)},n.prototype.containsPoint=function(e){return e.x>this.location.x&&e.x<this.location.x+this.width&&e.y>this.location.y&&e.y<this.location.y+this.height},n}),define("reset_button",[],function(){function e(e,t,n){this.location=e,this.width=90,this.height=40,this.color=t,this.pressed=!1,this.reset=n}return e.prototype.draw=function(e){var t=this.location.x,n=this.location.y,r=e.createLinearGradient(t,n,t,n+this.height);this.pressed?r.addColorStop(0,this.color):(r.addColorStop(0,"white"),r.addColorStop(1,this.color)),e.strokeStyle="#222",e.lineWidth=1,e.strokeRect(t,n,this.width,this.height),e.fillStyle=r,e.fillRect(t,n,this.width,this.height),e.fillStyle="#000",e.font="28px sans-serif",e.textBaseline="top",e.textAlign="left",e.fillText("Reset",t+5,n+5)},e.prototype.press=function(){this.pressed=!0,this.reset()},e.prototype.unPress=function(e){this.pressed=!1},e.prototype.setLocationComponents=function(e,t){this.location.x=e,this.location.y=t},e.prototype.setLocation=function(e){this.setLocationComponents(e.x,e.y)},e.prototype.containsPoint=function(e){return e.x>this.location.x&&e.x<this.location.x+this.width&&e.y>this.location.y&&e.y<this.location.y+this.height},e}),define("nucleus_label",[],function(){function e(e,t){this.location=e,this.text="",this.nucleonsInNucleus=t}return e.prototype.draw=function(e){var t=0,n=0;for(var r=0;r<this.nucleonsInNucleus.length;r++)this.nucleonsInNucleus[r].color=="red"?t++:this.nucleonsInNucleus[r].color=="gray"&&n++;this.updateText(t,n),e.fillStyle="#000",e.font="28px sans-serif",e.textBaseline="top",e.textAlign="left",e.fillText(this.text,this.location.x,this.location.y)},e.prototype.updateText=function(e,t){switch(e){case 0:this.text="";break;case 1:this.text="Hydrogen",t==0||t==1?this.text+=" (Stable)":this.text+=" (Unstable)";break;case 2:this.text="Helium",t==1||t==2?this.text+=" (Stable)":this.text+=" (Unstable)";break;case 3:this.text="Lithium",t==3||t==4?this.text+=" (Stable)":this.text+=" (Unstable)";break;case 4:this.text="Beryllium",t==5?this.text+=" (Stable)":this.text+=" (Unstable)";break;case 5:this.text="Boron",t==5||t==6?this.text+=" (Stable)":this.text+=" (Unstable)";break;case 6:this.text="Carbon",t==6||t==7?this.text+=" (Stable)":this.text+=" (Unstable)";break;case 7:this.text="Nitrogen",t==7||t==8?this.text+=" (Stable)":this.text+=" (Unstable)";break;case 8:this.text="Oxygen",t==8||t==9||t==10?this.text+=" (Stable)":this.text+=" (Unstable)";break;case 9:this.text="Fluorine",t==10?this.text+=" (Stable)":this.text+=" (Unstable)";break;case 10:this.text="Neon",t==10||t==11||t==12?this.text+=" (Stable)":this.text+=" (Unstable)";break;default:this.text="Phetium - "+(e+t)}},e.prototype.setLocationComponents=function(e,t){this.location.x=e,this.location.y=t},e.prototype.setLocation=function(e){this.setLocationComponents(e.x,e.y)},e}),define("proton",["nucleon"],function(e){function t(){e.call(this,"red")}return t.prototype=e.prototype,t}),define("neutron",["nucleon"],function(e){function t(){e.call(this,"gray")}return t.prototype=e.prototype,t}),define("caat-init",[],function(){function e(){console.log("Hello from CAAT woman."),CAAT.modules.initialization=CAAT.modules.initialization||{},CAAT.modules.initialization.init=function(e,t,n,r,i){var s=document.getElementById(n),o;if(CAAT.__CSS__)s&&0==s instanceof HTMLDivElement&&(s=null),s===null&&(s=document.createElement("div"),document.body.appendChild(s)),o=(new CAAT.Director).initialize(e||800,t||600,s);else{if(s){if(s instanceof HTMLDivElement){var u=document.createElement("canvas");s.appendChild(u),s=u}else if(0==s instanceof HTMLCanvasElement){var u=document.createElement("canvas");document.body.appendChild(u),s=u}}else s=document.createElement("canvas"),document.body.appendChild(s);CAAT.DEBUG=1,o=(new CAAT.Director).initialize(e||800,t||600,s)}(new CAAT.ImagePreloader).loadImages(r,function(e,t){e==t.length&&(o.emptyScenes(),o.setImagesCache(t),i(o),o.setScene(0),CAAT.loop(60))})}}return e}),require(["electron_shell","bucket","point2d","reset_button","nucleus_label","nucleon","proton","neutron","caat-init"],function(e,t,n,r,s,o,u,a,f){function l(){if("WebSocket"in window){var e=new WebSocket("ws://localhost:8887/echo");e.onmessage=function(e){document.location.reload(!0)},e.onclose=function(){},console.log("opened websocket")}else alert("WebSocket NOT supported by your Browser!")}function c(){Q()}function h(){l(),H=$("#canvas")[0],H.getContext&&(j=H.getContext("2d")),console.log("About to init CAAT"),f(),document.onmousedown=E,document.onmouseup=S,document.onmousemove=x,document.addEventListener("touchstart",T,!1),document.addEventListener("touchmove",N,!1),document.addEventListener("touchend",C,!1),z=new e(new n(325,150)),I=new t(new n(100,300),"gray","Neutrons"),q=new t(new n(400,300),"red","Protons"),U=new r(new n(600,325),"orange",m),W=new s(new n(450,80),F),m(),window.addEventListener("deviceorientation",k,!1),document.addEventListener("touchmove",function(e){e.preventDefault()},!1),c()}function p(){j.save(),j.globalCompositeOperation="source-over",j.fillStyle="rgb(255, 255, 153)",j.fillRect(0,0,Math.max(2e3,J),Math.max(2e3,K)),j.restore()}function d(){j.fillStyle="#00f",j.font="30px sans-serif",j.textBaseline="top",j.textAlign="left",j.fillText("Build an Atom",10,10)}function v(){j.fillStyle="#f80",j.font="italic 20px sans-serif",j.textBaseline="top",j.fillText("PhET",X-70,V-30)}function m(){b(),q.removeAllParticles(),I.removeAllParticles();for(var e=0;e<M;e++)q.addNucleonToBucket(new u);for(var e=0;e<_;e++)I.addNucleonToBucket(new a)}function g(){p(),d(),v(),z.draw(j),U.draw(j),I.drawInterior(j),q.drawInterior(j);for(var e=0;e<F.length;e++)F[e].draw(j);var t=q.nucleonsInBucket.slice();t.reverse();for(e=0;e<t.length;e++)t[e].draw(j);t=I.nucleonsInBucket.slice(),t.reverse();for(e=0;e<t.length;e++)t[e].draw(j);R!==null&&R.draw(j),I.drawFront(j),q.drawFront(j),W.draw(j)}function y(e){for(i=0;i<F.length;i++)if(F[i]==e){F.splice(i,1);break}w()}function b(){F.length=0}function w(){var e=(new o("black")).radius;if(F.length==0)return;if(F.length==1)F[0].setLocation(z.location);else if(F.length==2)F[0].setLocationComponents(z.location.x-e,z.location.y),F[1].setLocationComponents(z.location.x+e,z.location.y);else if(F.length==3)F[0].setLocationComponents(z.location.x,z.location.y-e*1.1),F[1].setLocationComponents(z.location.x+e*.77,z.location.y+e*.77),F[2].setLocationComponents(z.location.x-e*.77,z.location.y+e*.77);else if(F.length==4)F[0].setLocationComponents(z.location.x,z.location.y-e*1.5),F[1].setLocationComponents(z.location.x+e,z.location.y),F[2].setLocationComponents(z.location.x-e,z.location.y),F[3].setLocationComponents(z.location.x,z.location.y+e*1.5);else if(F.length>=5){F[F.length-1].setLocationComponents(z.location.x,z.location.y),F[F.length-2].setLocationComponents(z.location.x,z.location.y-e*1.5),F[F.length-3].setLocationComponents(z.location.x+e,z.location.y),F[F.length-4].setLocationComponents(z.location.x-e,z.location.y),F[F.length-5].setLocationComponents(z.location.x,z.location.y+e*1.5);var t=e*2;for(i=F.length-6;i>=0;i--){var n=Math.random()*Math.PI*2;F[i].setLocationComponents(z.location.x+t*Math.cos(n),z.location.y+t*Math.sin(n))}}}function E(e){L(new n(e.clientX,e.clientY))}function S(e){O()}function x(e){A(new n(e.clientX,e.clientY))}function T(e){e.touches.length==1&&(e.preventDefault(),L(new n(e.touches[0].pageX,e.touches[0].pageY)))}function N(e){e.touches.length==1&&(e.preventDefault(),A(new n(e.touches[0].pageX,e.touches[0].pageY)))}function C(e){O()}function k(e){}function L(e){B=!0,R=null;for(var t=0;t<F.length;t++)if(F[t].containsPoint(e)){R=F[t],y(R);break}if(R==null)for(var t=0;t<q.nucleonsInBucket.length;t++)if(q.nucleonsInBucket[t].containsPoint(e)){R=q.nucleonsInBucket[t],q.removeNucleonFromBucket(R);break}if(R==null)for(var t=0;t<I.nucleonsInBucket.length;t++)if(I.nucleonsInBucket[t].containsPoint(e)){R=I.nucleonsInBucket[t],I.removeNucleonFromBucket(R);break}R!=null?R.setLocation(e):U.containsPoint(e)&&U.press(),g()}function A(e){B&&R!=null&&(R.setLocation(e),g())}function O(){B=!1,R!=null&&(z.containsPoint(R.location)?(F.push(R),w()):R instanceof u?q.addNucleonToBucket(R):I.addNucleonToBucket(R),R=null),U.pressed&&U.unPress(),g()}var M=10,_=10,D=20,P=10,H,B=!1,j,F=[],I,q,R=null,U,z,W,X=0,V=0,J=0,K=0,Q=function(){if(window.innerWidth!==X||window.innerHeight!==V)X=window.innerWidth,H.width=X,V=window.innerHeight?window.innerHeight:$(window).height(),H.height=V,window.scrollTo(0,0),X>J&&(J=X),V>K&&(K=V),g()};$(document).ready(function(){h()}),$(window).resize(c)}),define("main",function(){}),require.config({deps:["main"],paths:{vendor:"../js/vendor",plugins:"../js/plugins",underscore:"../js/vendor/underscore-min",tpl:"../js/plugins/tpl",text:"../js/plugins/text",json:"../js/plugins/json"},shim:{underscore:{exports:"_"},"main-deprecated":[]}}),define("config",function(){});