<project name="General Ant Build Script" default="dist" basedir=".">

    <taskdef name="gpl" classname="org.srr.ant.tasks.prepend.GPLPrepend"/>

    <property name="src" location="src"/>
    <property name="data" location="data"/>
    <property name="build" location="../ant_output/build"/>
    <property name="dist" location="../ant_output/dist"/>
    <property name="backup" location="../backup"/>
    <property name="releases" location="../releases"/>
    <property name="javadoc" location="../ant_output/javadoc"/>

    <description>
        Build File.
    </description>

    <target name="init">
        <tstamp/>
    </target>

    <target name="backupSource" depends="init">
        <mkdir dir="${backup}"/>
        <tstamp>
            <format property="backup.time" pattern="d-MMMM-yyyy h-maa" locale="en"></format>
        </tstamp>
        <mkdir dir="${backup}/src_${backup.time}"/>
        <copy todir="${backup}/src_${backup.time}">
            <fileset dir="${src}"/>
        </copy>
    </target>

    <target name="clean"
        description="clean up">
        <delete dir="${build}"/>
        <delete dir="${dist}"/>
        <delete dir="${javadoc}"/>
    </target>

    <target name="compile" depends="init"
        description="compile the source ">

        <mkdir dir="${build}"/>
        <!-- Compile the java code from ${src} into ${build} -->
        <javac srcdir="${src}" destdir="${build}">
            <classpath>
                <filelist id="myclasspath" dir="${class.path.drive}"
                    files="${class.path.file.list}"/>
            </classpath>
        </javac>
    </target>

    <target name="dist" depends="compile"
        description="generate the distribution">
        <!-- Create the distribution directory -->
        <mkdir dir="${dist}"/>
        <buildnumber/>
        <jar destfile="${dist}/${distname}.jar">
            <fileset dir="${build}"/>
            <fileset dir="${data}">
            <exclude name="**/*.db"/>
                </fileset>
            <manifest>
                <attribute name="Built-By" value="${user.name}"/>
                <attribute name="version" value="${version}"/>
                <attribute name="build" value="${build.number}"/>
                <attribute name="Main-Class"  value="${main.class}"/>
            </manifest>
        </jar>
    </target>

    <target name="javadoc">
        <javadoc
            destdir="${javadoc}"
            author="true"
            version="true"
            use="true"
            >
            <classpath>
                <filelist id="cp" dir="${class.path.drive}"
                    files="${class.path.file.list}"/>
            </classpath>
            <packageset dir="src" defaultexcludes="yes">
            </packageset>
            <bottom><![CDATA[<i>Copyright &#169; 2003 Sam Reid. All Rights Reserved.</i>]]></bottom>
            <link href="http://java.sun.com/products/jdk/1.4/docs/api/"/>
        </javadoc>
    </target>
    <target name="release" depends="clean,dist,javadoc"
        description="generate the release distribution, including binary, source and docs">
        <!-- Create the distribution directory -->
        <mkdir dir="${releases}"/>
        <mkdir dir="${releases}/${distname}${version}_build-${build.number}"/>
        <mkdir dir="${releases}/${distname}${version}_build-${build.number}/src"/>
        <mkdir dir="${releases}/${distname}${version}_build-${build.number}/bin"/>
        <mkdir dir="${releases}/${distname}${version}_build-${build.number}/javadoc"/>

        <copy todir="${releases}/${distname}${version}_build-${build.number}">
            <fileset dir="." casesensitive="yes">
                <include name="*.txt"/>
            </fileset>
        </copy>

        <copy todir="${releases}/${distname}${version}_build-${build.number}/bin">
            <fileset dir="${dist}"/>
        </copy>
        <copy todir="${releases}/${distname}${version}_build-${build.number}/javadoc">
            <fileset dir="${javadoc}"/>
        </copy>

        <copy todir="${releases}/${distname}${version}_build-${build.number}/src">
            <filterset>
                <filter token="ant_header" value="This file is part of ${projectname}.${line.separator}${line.separator}${projectname} is free software; you can redistribute it and/or modify${line.separator}it under the terms of the GNU General Public License as published by${line.separator}the Free Software Foundation; either version 2 of the License, or${line.separator}(at your option) any later version.${line.separator}${line.separator}${projectname} is distributed in the hope that it will be useful,${line.separator}but WITHOUT ANY WARRANTY; without even the implied warranty of${line.separator}MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the${line.separator}GNU General Public License for more details.${line.separator}${line.separator}You should have received a copy of the GNU General Public License${line.separator}along with Foobar; if not, write to the Free Software${line.separator}Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA${line.separator}${line.separator}Copyright ${user.name}, 2003"/>
            </filterset>
            <fileset dir="${src}"/>
        </copy>
    </target>

    <target name="Release GPL" depends="release"
        description="Edit the build release to include GPL data.">
        <tstamp>
            <format property="current.year" pattern="yyyy" locale="en"></format>
        </tstamp>
        <gpl projectname="${projectname}" author="${user.name}" year="${current.year}" dir="${releases}/${distname}${version}_build-${build.number}/src"/>
        <copy file="${gpl}" todir="${releases}/${distname}${version}_build-${build.number}"/>
    </target>


</project>