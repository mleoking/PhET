<project name="General Ant Build Script" default="Publish Executables" basedir=".">

    <property name="root" value=".."/>
    <!--  Set ant output directories.  -->
    <property name="ant.output" value="${root}/ant_output"/>
    <property name="ant.classes" location="${ant.output}/classes"/>
    <property name="ant.jars" location="${ant.output}/jars"/>
    <property name="ant.javadoc" location="${ant.output}/javadoc"/>
    <property name="ant.lib" location="${ant.output}/lib"/>

    <!--    Set current sister directories, for backup and release data. -->
    <property name="backup" location="../backup"/>
    <property name="releases" location="../releases"/>

    <property file="build.properties"/>
    <property file="local.properties"/>
    <property file="build.time.stamp" location="data"/>

    <property name="build.number.txt" value="data/${distname}.build.number"/>
    <property name="timestamp.name" value="data/${distname}.build.time.stamp"/>

    <property name="phet-ssh-root" value="/Net/www/webdata/htdocs/UCB/AcademicAffairs/ArtsSciences/physics/phet"/>
    <property name="dev-dir" value="${phet-ssh-root}/${dev-path}/${dev-version}"/>

    <taskdef resource="proguard/ant/task.properties" classpath="${root}/antutil-dir/lib/proguard.jar"/>
    <taskdef name="maverick-ssh" classname="com.sshtools.ant.Ssh" classpath="${root}/antutil-dir/lib/maverick-ant.jar"/>

    <target name="init">
        <tstamp/>
    </target>

    <target name="Clean"
            description="clean up">
        <delete dir="${ant.classes}"/>
        <delete dir="${ant.jars}"/>
        <delete dir="${ant.javadoc}"/>
        <delete dir="${ant.lib}"/>
    </target>

    <target name="Compile" depends="init, Clean">
        <mkdir dir="${ant.classes}"/>
        <javac srcdir="${build-src}"
               excludes="${build-excludes}"
               classpath="${build-classpath}"
               destdir="${ant.classes}"/>
    </target>

    <target name="Generate Build Info">
        <!--<buildnumber file="${build.number.txt}"/>-->
        <!--<tstamp>-->
            <!--<format property="jar.creation.time" pattern="d-MMMM-yyyy h:mm aa" locale="en" timezone="MST"/>-->
        <!--</tstamp>-->
        <!--<echo file="${timestamp.name}" message="${jar.creation.time}"></echo>-->
    </target>

    <target name="Generate Jar" depends="Compile"
            description="generate the distribution">
        <!-- Create the distribution directory -->
        <delete dir="${ant.jars}"/>
        <mkdir dir="${ant.jars}"/>
        <antcall target="Generate Build Info"/>
        <!--<property file="${build.number.txt}"/>-->
        <jar destfile="${ant.jars}/${distname}.jar">
            <fileset dir="${ant.classes}"/>
            <fileset dir="${root}/data"/>
            <fileset dir="${root}/phetgraphics-module/data"/>
            <fileset dir="${root}/phetgraphics-module/phetcommon-module/data"/>
            <fileset dir="${root}/piccolo-phet-dir/data"/>
            <manifest>
                <attribute name="Main-Class" value="${main.class}"/>
            </manifest>
        </jar>
    </target>

    <target name="ProGuard" depends="Generate Jar">
        <proguard configuration="${proguard-file}"/>
    </target>

    <target name="Update JNLP">
        <copy todir="ant_output/jnlp" overwrite="yes">
            <fileset file="${jnlp-filename}"/>
            <filterset>
                <filter token="VERSION" value="${dev-version}"/>
                <filter token="MAIN-CLASS" value="${main.class}"/>
            </filterset>
        </copy>
    </target>

    <target name="Post Dev">
        <maverick-ssh host="${ssh-host}"
                      username="${username}"
                      password="${password}"
                      version="2">
            <sftp action="mkdir"
                  remotedir="${dev-dir}"/>
            <sftp action="put" remotedir="${dev-dir}" verbose="true">
                <fileset file="ant_output/jars/theramp-pro.jar"/>
                <fileset file="ant_output/jnlp/theramp.jnlp"/>
                <fileset file="todo.txt"/>
                <fileset file="changes.txt"/>
            </sftp>
        </maverick-ssh>
    </target>

    <target name="Build and Deploy" depends="ProGuard,Update JNLP,Post Dev"/>

</project>